import{u as Z,n as $,ao as ee,j as e,B as g,o as N,aR as re,aS as ae,aT as ie,L as m,I as u}from"./index-DmWoIqkz.js";import{u as te,r as a}from"./react-vendor-Dgs0PnIs.js";import{aE as oe,B as le}from"./utils-vendor-BGFQbqN_.js";import"./ui-vendor-DDOKmtGI.js";import"./export-vendor-CIONKkl6.js";import"./date-vendor-B-iErbnr.js";import"./mui-vendor-ChyyRTJQ.js";const Ne=()=>{const{user:o}=Z(),v=te(),{toast:i}=$(),[l,P]=a.useState(""),[c,E]=a.useState(""),[h,w]=a.useState(""),[J,j]=a.useState(!1),[D,V]=a.useState(!1),[B,y]=a.useState(!1),[H,C]=a.useState(!1),S=a.useRef(null),M="/storage/uploads/avatars/default-avatar.png",k=r=>ee.getFileUrl(r||""),[ne,T]=a.useState(null),[x,U]=a.useState(""),[f,A]=a.useState(""),[b,F]=a.useState(""),[R,G]=a.useState(!1),[I,p]=a.useState("");a.useEffect(()=>{if(o){P(o.full_name||""),E(o.title||"");const r=o.avatar_url||M;w(k(r)),q()}},[o]);const q=async()=>{try{C(!1),T(null),console.log("Google connection check not implemented in this context")}catch(r){console.error("Error checking Google connection:",r)}},z=async()=>{try{i({title:"חיבור לגוגל אינו זמין כרגע",description:"פונקציונליות זו אינה זמינה בסביבה זו",variant:"destructive"})}catch(r){i({title:"שגיאה בהתחברות לגוגל",description:r.message,variant:"destructive"})}},Y=async()=>{try{C(!1),T(null),i({title:"חשבון גוגל נותק בהצלחה"})}catch(r){console.error("Error disconnecting Google account:",r),i({title:"שגיאה בניתוק חשבון גוגל",description:r.message,variant:"destructive"})}},K=async()=>{try{if(G(!0),p(""),!x||!f||!b){p("כל השדות נדרשים");return}if(f!==b){p("הסיסמאות החדשות אינן תואמות");return}if(f.length<8){p("הסיסמה החדשה חייבת להיות באורך של לפחות 8 תווים");return}const r=await fetch("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:x,newPassword:f}),credentials:"include"}),t=await r.json();if(!r.ok)throw new Error(t.error||"שגיאה בשינוי הסיסמה");i({title:"סיסמה שונתה בהצלחה"}),U(""),A(""),F("")}catch(r){console.error("Error changing password:",r),p(r.message||"שגיאה בשינוי הסיסמה"),i({title:"שגיאה בשינוי הסיסמה",description:r.message,variant:"destructive"})}finally{G(!1)}},Q=()=>{S.current?.click()},W=async r=>{try{if(j(!0),!r.target.files||r.target.files.length===0)throw new Error("You must select an image to upload.");const t=r.target.files[0],d=new FormData;d.append("file",t);const n=await fetch("/api/storage/upload/avatars",{method:"POST",body:d,credentials:"include"});if(!n.ok){const s=await n.json();throw new Error(s.error||"Failed to upload file")}const O=(await n.json()).data.path;w(k(O));const L=await fetch("/api/auth/update-profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({full_name:l,title:c,avatar_url:O}),credentials:"include"});if(!L.ok){const s=await L.json();throw new Error(s.error||"Failed to update profile")}const _=await fetch("/api/auth/refresh-user-data",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(_.ok){const s=await _.json();console.log("Refreshed user data:",s),localStorage.setItem("user",JSON.stringify(s)),window.dispatchEvent(new CustomEvent("userDataUpdated",{detail:s}))}i({title:"התמונה הועלתה בהצלחה"})}catch(t){console.error("Error uploading avatar:",t),i({title:"שגיאה בהעלאת התמונה",description:t.message,variant:"destructive"})}finally{j(!1)}},X=async()=>{try{V(!0),console.log("Attempting to update profile with data:",{name:l,title:c,avatarUrl:h});const r=await fetch("/api/auth/update-profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({full_name:l,title:c,avatar_url:h}),credentials:"include"});console.log("Profile update response status:",r.status);const t=await r.json();if(console.log("Profile update response data:",t),!r.ok)throw new Error(t.error||"שגיאה בעדכון הפרופיל");const d=await fetch("/api/auth/refresh-user-data",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(d.ok){const n=await d.json();console.log("Refreshed user data:",n),localStorage.setItem("user",JSON.stringify(n)),window.dispatchEvent(new CustomEvent("userDataUpdated",{detail:n}))}else console.error("Failed to refresh user data:",d.status);i({title:"פרופיל עודכן בהצלחה"})}catch(r){console.error("Error updating profile:",r),i({title:"שגיאה בעדכון הפרופיל",description:r.message,variant:"destructive"})}finally{V(!1)}};return o?e.jsxDEV("div",{className:"container mx-auto py-6 px-4 max-w-4xl direction-rtl",children:[e.jsxDEV("div",{className:"flex justify-between items-center mb-6",children:[e.jsxDEV("h1",{className:"text-3xl font-bold",children:"פרופיל משתמש"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:315,columnNumber:9},void 0),e.jsxDEV(g,{variant:"outline",onClick:()=>v(-1),className:"flex items-center gap-2",children:[e.jsxDEV(oe,{className:"w-4 h-4"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:321,columnNumber:11},void 0),"חזור"]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:316,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:314,columnNumber:7},void 0),e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxDEV("div",{className:"md:col-span-1",children:[e.jsxDEV(N,{className:"p-6 flex flex-col items-center shadow-sm",children:[e.jsxDEV("div",{className:"relative",onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1),onClick:Q,children:[e.jsxDEV(re,{className:"w-24 h-24 cursor-pointer",children:[e.jsxDEV(ae,{src:h,alt:l||"User Avatar"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:337,columnNumber:17},void 0),e.jsxDEV(ie,{children:l?.charAt(0)||"U"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:338,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:336,columnNumber:15},void 0),B&&e.jsxDEV("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full cursor-pointer",children:e.jsxDEV(le,{className:"text-white w-6 h-6"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:342,columnNumber:19},void 0)},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:341,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:330,columnNumber:13},void 0),e.jsxDEV("input",{type:"file",ref:S,className:"hidden",accept:"image/*",onChange:W},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:346,columnNumber:13},void 0),e.jsxDEV("h2",{className:"text-xl font-semibold mt-4 text-center",children:l||"שם משתמש"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:353,columnNumber:13},void 0),e.jsxDEV("p",{className:"text-muted-foreground text-center",children:c||"תפקיד לא מוגדר"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:354,columnNumber:13},void 0),J&&e.jsxDEV("p",{className:"text-sm text-blue-500 mt-2",children:"מעלה תמונה..."},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:355,columnNumber:27},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:329,columnNumber:11},void 0),e.jsxDEV(N,{className:"p-6 mt-6 shadow-sm",children:[e.jsxDEV("h2",{className:"text-lg font-semibold mb-4",children:"חשבון גוגל"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:360,columnNumber:13},void 0),e.jsxDEV("p",{className:"text-sm text-muted-foreground mb-4",children:"חיבור חשבון גוגל מאפשר גישה לקבצים משותפים ולוחות שנה"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:361,columnNumber:13},void 0),H?e.jsxDEV("div",{children:[e.jsxDEV("p",{className:"text-green-600 font-medium mb-4",children:"חשבון גוגל מחובר"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:366,columnNumber:17},void 0),e.jsxDEV(g,{variant:"outline",className:"w-full border-destructive text-destructive hover:bg-destructive/10",onClick:Y,children:"נתק חשבון גוגל"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:367,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:365,columnNumber:15},void 0):e.jsxDEV(g,{variant:"outline",className:"w-full",onClick:z,children:"חבר חשבון גוגל"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:376,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:359,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:328,columnNumber:9},void 0),e.jsxDEV("div",{className:"md:col-span-2",children:[e.jsxDEV(N,{className:"p-6 shadow-sm",children:[e.jsxDEV("h2",{className:"text-lg font-semibold mb-4",children:"פרטי משתמש"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:390,columnNumber:13},void 0),e.jsxDEV("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxDEV("div",{children:[e.jsxDEV(m,{htmlFor:"name",children:"שם מלא"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:393,columnNumber:17},void 0),e.jsxDEV(u,{id:"name",value:l,onChange:r=>P(r.target.value)},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:394,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:392,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV(m,{htmlFor:"title",children:"תפקיד"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:401,columnNumber:17},void 0),e.jsxDEV(u,{id:"title",value:c,onChange:r=>E(r.target.value)},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:402,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:400,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV(m,{htmlFor:"email",children:'דוא"ל'},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:409,columnNumber:17},void 0),e.jsxDEV(u,{id:"email",value:o?.email||"",disabled:!0},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:410,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:408,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:391,columnNumber:13},void 0),e.jsxDEV("div",{className:"mt-6 flex justify-end",children:e.jsxDEV(g,{onClick:X,disabled:D,children:D?"שומר...":"שמור שינויים"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:418,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:417,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:389,columnNumber:11},void 0),e.jsxDEV(N,{className:"p-6 mt-6 shadow-sm",children:[e.jsxDEV("h2",{className:"text-lg font-semibold mb-4",children:"שינוי סיסמה"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:426,columnNumber:13},void 0),I&&e.jsxDEV("div",{className:"mb-4 p-3 bg-destructive/10 text-destructive rounded-md text-sm",children:I},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:428,columnNumber:15},void 0),e.jsxDEV("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxDEV("div",{children:[e.jsxDEV(m,{htmlFor:"currentPassword",children:"סיסמה נוכחית"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:434,columnNumber:17},void 0),e.jsxDEV(u,{id:"currentPassword",type:"password",value:x,onChange:r=>U(r.target.value)},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:435,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:433,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV(m,{htmlFor:"newPassword",children:"סיסמה חדשה"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:443,columnNumber:17},void 0),e.jsxDEV(u,{id:"newPassword",type:"password",value:f,onChange:r=>A(r.target.value)},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:444,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:442,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV(m,{htmlFor:"confirmNewPassword",children:"אישור סיסמה חדשה"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:452,columnNumber:17},void 0),e.jsxDEV(u,{id:"confirmNewPassword",type:"password",value:b,onChange:r=>F(r.target.value)},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:453,columnNumber:17},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:451,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:432,columnNumber:13},void 0),e.jsxDEV("div",{className:"mt-6 flex justify-end",children:e.jsxDEV(g,{onClick:K,disabled:R,children:R?"משנה סיסמה...":"שנה סיסמה"},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:462,columnNumber:15},void 0)},void 0,!1,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:461,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:425,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:388,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:326,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/iteam/radio-lineup-generator-rtl-78/src/pages/Profile.tsx",lineNumber:313,columnNumber:5},void 0):(v("/login"),null)};export{Ne as default};
